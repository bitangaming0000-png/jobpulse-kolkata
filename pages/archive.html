<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Archive â€” JobPulse Kolkata</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <style>
      .dates{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
      .dates a.badge{cursor:pointer}
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Archive</h1>
      <div id="dateChips" class="dates"></div>
      <div id="list" class="grid"></div>
    </div>
    <script type="module">
      import { el, truncate } from '/assets/js/utils.js';

      function card(p){
        const c = el('article','card');
        c.innerHTML = \`<h3><a href="/pages/post.html?title=\${encodeURIComponent(p.title)}&link=\${encodeURIComponent(p.link)}&desc=\${encodeURIComponent(p.description)}&date=\${encodeURIComponent(p.pubDate||'')}">\${p.title}</a></h3><p>\${truncate(p.description, 180)}</p>\`;
        return c;
      }

      async function listDates(){
        const r = await fetch('/.netlify/functions/archive?list=1');
        const j = await r.json();
        const wrap = document.getElementById('dateChips');
        wrap.innerHTML = '';
        (j.dates||[]).forEach(k=>{
          const d = k.replace('.json','');
          const a = el('a','badge', d);
          a.href = '#'; a.addEventListener('click', e=>{e.preventDefault(); loadDate(d);});
          wrap.appendChild(a);
        });
      }

      async function loadDate(date){
        const r = await fetch('/.netlify/functions/archive?date=' + encodeURIComponent(date));
        const j = await r.json();
        const list = document.getElementById('list');
        list.innerHTML = '';
        (j.items||[]).forEach(p=> list.appendChild(card(p)));
        if(!list.children.length){
          const m = document.createElement('p'); m.className='notice'; m.textContent='No posts archived for this date.'; list.parentElement.appendChild(m);
        }
      }

      (async()=>{
        await listDates();
        // Try load today by default
        const today = new Date().toISOString().slice(0,10);
        loadDate(today);
      })();
    </script>
    <script type="module" src="/assets/js/main.js"></script>
  </body>
</html>
