<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Search â€” JobPulse Kolkata</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <style>
      .searchbar{display:flex;gap:8px;margin:8px 6px 16px}
      .searchbar input{flex:1;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text)}
      .searchbar button{padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);cursor:pointer}
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Search Jobs (WB)</h1>
      <div class="searchbar">
        <input id="q" type="search" placeholder="Try: teacher, clerk, police..." />
        <button id="go">Search</button>
      </div>
      <div id="results" class="grid"></div>
    </div>
    <script type="module">
      import { el, truncate } from '/assets/js/utils.js';
      async function getRSS(){ try{ const r=await fetch('/api/rss'); const j=await r.json(); return j.items||[] }catch{ return [] } }
      function card(p){
        const c = el('article','card');
        c.innerHTML = `<h3><a href="/pages/post.html?title=${encodeURIComponent(p.title)}&link=${encodeURIComponent(p.link)}&desc=${encodeURIComponent(p.description)}&date=${encodeURIComponent(p.pubDate||'')}">${p.title}</a></h3><p>${truncate(p.description, 160)}</p>`;
        return c;
      }
      async function search(){
        const q=document.getElementById('q').value.trim().toLowerCase();
        const results=document.getElementById('results'); results.innerHTML='';
        const items=await getRSS();
        const hits=items.filter(p=>(p.title+p.description).toLowerCase().includes(q));
        hits.forEach(p=>results.appendChild(card(p)));
        if(!hits.length){ const m=document.createElement('p');m.className='notice';m.textContent='No results found.';results.appendChild(m);}
      }
      document.getElementById('go').addEventListener('click',search);
      document.getElementById('q').addEventListener('keypress',e=>{if(e.key==='Enter')search();});
    </script>
    <script type="module" src="/assets/js/main.js"></script>
  </body>
</html>
